# sso-paypal

SSO is a service which authenticates a CORP user then provides the authenticated session details to an application.
SSO team supports SSO for all environment with following entryPoints

- **LIVE**: https://sso.paypalcorp.com/idp/SSO.saml2
- **Staging**: https://ssoqa.paypalcorp.com/idp/SSO.saml2
- **Development**: https://ssodev.paypalcorp.com/idp/SSO.saml2

Work with SSO team as documented in [help](#help).

## Getting Started

Install the module into Kraken app.

```bash
npm i --save sso-paypal
```

### Apps on-boarding to use SSO

Example of SSO Config:

```json
"middleware": {
    "sso": {
      "enabled": true,
      "priority": 110,
      "module": {
        "name": "sso-paypal",
        "arguments": [{
            "issuer":"{issuer name set up with sso}",
            "protocol": "https://",
            "entryPoint": "{entry point received from sso}",
            "ssoKeyStore": <keymaker_sso_keystore_name>
        }]
      }
    },
    ...
}
```

## Documentation

- Read about SSO in general on the [SSO Team's Confluence site](https://engineering.paypalcorp.com/confluence/display/ISMEDAEng/SSO+Integration+Engagement+Process).

- Please follow the instructions at [kraken & SSO docs](https://github.paypal.com/nodejs/nodejs.github.paypal.com/blob/master/docs/kraken-and-sso.md)

## Notes

- Session store (most likely it will be mayfly for regular PayPal apps) is required. Make sure that `sso-paypal` has higher priority (ideally 108) than `session` (which is by default 100).
- If you are getting CSRF Error, make sure `appsec` middleware (by default 110) comes after `sso-paypal` (ideally 108).
- SSO should be enabled in all the environment. SSO team has end points to configure sso both LIVE as well as staging. Development SSO will be similar to staging one except http protocol. Refer to the entryPoints on the top of this documentation for environment specifics.

## Testing

`devMode: true` won't work anymore as of `sso-paypal@^3`.
For easy SSO testing, in test environment you can pass custom user object in the config.
This override will only work if `NODE_ENV=test` and `user` object is set.

Something like this in test.json

```json
"middleware": {
    "sso": {
      "enabled": true,
      "priority": 110,
      "module": {
        "name": "sso-paypal",
        "arguments": [{
            "user": {
              "userName": "PayPal",
              "firstName": "Pay",
              "lastName": "Pal"
            }
        }]
      }
    },
    ...
}
```

or like this if using the module directly as express middleware

```js
const sso = require('sso-paypal');
..
..
const ssoConfig = {
  user: {
    UserName: 'paypal',
    FirstName: 'Pay',
    LastName: 'Pal'
  }
};
app.use(sso(ssoConfig));
...
```

## Help

* SSO Team DL's (needed to register your app):  [DL-PayPal-ISM-IAM-SSO-Request@paypal.com](mailto:DL-PayPal-ISM-IAM-SSO-Request@paypal.com);
* For SSO Production support: [DL-PayPal-ISM-IAM-SSO-Operations@paypal.com](mailto:DL-PayPal-ISM-IAM-SSO-Operations@paypal.com)
* For SSO Keystore (keys/certificates) related questions: [DL-PP-KeyMaker-Ops@paypal.com](mailto:DL-PP-KeyMaker-Ops@paypal.com)
* For questions or comments, join #node-sso Slack channel.
